---
title: "EastRiver_almont"
author: "CGA"
date: "July 3, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Load necessary packages
library(tidyverse)
library(readxl)
library(gridExtra)
library(lubridate)
# Set working directory
setwd("~/east-river/")
```

## Load and tidy Almont data
```{r}
# Discharge
# https://waterdata.usgs.gov/nwis/uv/?site_no=09112500&PARAmeter_cd=00060,00065
# Measured in cubic feet per second; need from April 1 thru July 1, 2018
discharge_1 <- read_tsv("Data/EastRiver_discharge/23July2018_east_river_almont_discharge.txt", skip=28)
discharge_1 <- discharge_1[-1, ] #remove first row
discharge_1 <- discharge_1[c(1:8832), ] #need from April 1 thru July 1, 2018


# updated discharge values; missing through July 1, 2018
discharge_2 <- read_tsv("Data/EastRiver_discharge/30Oct2018_east_river_almont_discharge.txt", skip=29)
discharge_2 <- discharge_2[-1, ] #remove first row
discharge_2 <- discharge_2[c(8833:20402), ] #need from July 2, 2018 thru last date


# need to combine so we have the whole dataset
discharge <- rbind(discharge_1, discharge_2)

```


## Tidy data
```{r}
discharge <- discharge[ , c(3,5,7)] #Only taking date/time, discharge, gage height data

colnames(discharge)[c(2,3)] <- c("discharge_cfs", "gageheight_ft") #Rename columns

# Converting date column
discharge$datetime <- as.POSIXct(discharge$datetime, format = "%Y-%m-%d %H:%M")
discharge$date <- as.Date(discharge$datetime, "%Y-%m-%d")

# Change to numeric
discharge$discharge_cfs <- as.numeric((discharge$discharge_cfs))
discharge$gageheight_ft <- as.numeric((discharge$gageheight_ft))

```


## Plots
```{r}
# Soil sampling dates
soil_sampling <- c("2018-05-28 00:00:00", "2018-06-08 00:00:00", "2018-06-18 00:00:00", "2018-06-28 00:00:00", "2018-07-23 00:00:00", "2018-09-22 00:00:00")
soil_sampling <- as.POSIXct(soil_sampling)
soil_sampling <- data.frame(soil_sampling)

soil_sampling <- merge(discharge, soil_sampling)

ggplot(discharge) +
  geom_line(data=discharge, aes(x=datetime, y=gageheight_ft), color="blue", size=1) +
  geom_point(data = soil_sampling, aes(x = soil_sampling, y=gageheight_ft), color = "red") +
  xlab("Date") + ylab("East River height (feet)") +
  theme_bw() +
  theme(axis.text = element_text(size = 15),
        axis.title = element_text(size = 15),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())

# For website:
ggplot(discharge[which(discharge$datetime > "2018-05-09 12:00:00"), ])  +
  geom_line(aes(x=datetime, y=gageheight_ft), color="blue", size=1) +
#  geom_point(data = soil_sampling, aes(x = soil_sampling, y=gageheight_ft), color = "red") +
  xlab("") + ylab("East River height (ft)") +
  theme_bw() +
  theme(axis.text = element_text(size = 22),
        axis.title = element_text(size = 22),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())

# overlay discharge?

```

