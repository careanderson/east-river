---
title: "EastRiver_TOC"
author: "CGA"
date: "May 11, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Load necessary packages
library(tidyverse)
library(readxl)
# Set working directory
setwd("~/east-river/")
```

## TOTAL ORGANIC CARBON
## Load files with TOC data, rbind, and tidy
```{r}
TOC_1 <- read.table("Data/TOC/11May2018_EastRiver_TOC_H2O_HCl_means.txt", skip=11, fill=TRUE)[ , c(3,5)]
TOC_2 <- read.table("Data/TOC/12May2018_EastRiver_TOC_dith_pp_means.txt", skip=11, fill=TRUE)[ , c(4,5)]

# Label columns
colnames(TOC_1) <- c("sample","c_ppm")
colnames(TOC_2) <- c("sample","c_ppm")

# Row-bind TOC_1 and TOC_2
TOC <- rbind(TOC_1, TOC_2)

# If blanks and standard checks look ok, take them out
TOC_samples <- TOC[grep("x", TOC$sample), ]
TOC_samples$c_ppm <- as.numeric(TOC_samples$c_ppm)

# Separate the sample column
TOC_samples <- TOC_samples %>%
  separate(sample, c("ID", "extraction", "dilution_toc"), "-")

```


## Merge with MP-ICP-AES data
```{r}
mp <- read.csv("Data/MP-ICP-AES/mp-icp-aes_total_processed.csv")
cn <- read.csv("Data/EA_data/25April2018_EA_total_cn_processed.csv")

# Replace "h20" with "h2o" in mp dataframe
mp$extraction <- as.character(mp$extraction)
mp$extraction[mp$extraction == "h20"] <- "h2o"

toc_mp <- merge(TOC_samples, mp, by=c("ID", "extraction"))
```

## Prelim figures
```{r}
ggplot(subset(toc_mp, `Element.Label` %in% "Al")) +
  aes(x=top_cm, y=c_ppm) +
  geom_point() +
  facet_wrap(~extraction, scales="free") +
  xlab("soil depth (cm)") + ylab("TOC (ppm)")

ggplot(subset(toc_mp, `Element.Label` %in% "Fe")) +
  aes(x=top_cm, y=c_ppm) +
  geom_point() +
  facet_wrap(~extraction, scales="free") +
  xlab("soil depth (cm)") + ylab("TOC (ppm)")


ggplot(subset(toc_mp, `Element.Label` %in% "Al")) +
  aes(x=Concentration, y=c_ppm) +
  geom_point() +
  facet_wrap(~extraction, scales="free")

ggplot(toc_mp) +
  aes(x=Concentration, y=c_ppm, color=top_cm) +
  geom_point() +
  facet_wrap(~extraction+`Element.Label`, scales="free") +
  xlab("element concentration (ppm)") + ylab("TOC (ppm)")
```

## TOTAL NITROGEN
## Load files with TN data, rbind, and tidy
```{r}
TN_1 <- read.table("Data/TOC/13May2018_EastRiver_TN_H2O_HCl_means.txt", skip=11, fill=TRUE)[ , c(4,5)]
TN_2 <- read.table("Data/TOC/14May2018_EastRiver_TN_dith_pp_means.txt", skip=11, fill=TRUE)[ , c(4,5)]

# Label columns
colnames(TN_1) <- c("sample","n_ppm")
colnames(TN_2) <- c("sample","n_ppm")

# Row-bind TN_1 and TN_2
TN <- rbind(TN_1, TN_2)

# If blanks and standard checks look ok, take them out
TN_samples <- TN[grep("x", TN$sample), ]
TN_samples$n_ppm <- as.numeric(as.character(TN_samples$n_ppm))

# Separate the sample column
TN_samples <- TN_samples %>%
  separate(sample, c("ID", "extraction", "dilution_tn"), "-")

# Merge with TOC/MP data
total_toc_tn <- merge(TN_samples, toc_mp, by=c("ID", "extraction"))

```

## Prelim figures
```{r}
ggplot(subset(total_toc_tn, `Element.Label` %in% "Al")) +
  aes(x=top_cm, y=n_ppm) +
  geom_point() +
  facet_wrap(~extraction, scales="free") +
  xlab("soil depth (cm)") + ylab("TN (ppm)")

ggplot(subset(total_toc_tn, `Element.Label` %in% "Al")) +
  aes(x=Concentration, y=n_ppm) +
  geom_point() +
  facet_wrap(~extraction, scales="free")

ggplot(total_toc_tn) +
  aes(x=Concentration, y=n_ppm, color=top_cm) +
  geom_point() +
  facet_wrap(~extraction+`Element.Label`, scales="free") +
  xlab("element concentration (ppm)") + ylab("TN (ppm)")

ggplot(total_toc_tn) +
  aes(x=c_ppm, y=n_ppm) +
  geom_point() +
  facet_wrap(~extraction, scales="free")

```

## To do
```{r}
# Correct MP data for soil weight/dilutions
# TIC? (= TN - TOC?)
```